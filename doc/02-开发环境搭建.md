# 开发环境搭建

​	本节我们将要搭建Flyanx的开发环境，从开发需要的编译以及调试工具，以及IDE的选取。编译相关的环境是必须的，但开发的IDE可以选用自己喜欢的即可。

## 内核工程结构

​	Flyanx灵感自于MINIX2和Linux0.11，主要结构和MINIX相似，所有的内核级别（CPU特权级0,1）的代码将集中放在一起，它们只完成最基本的功能：底层对I/O的操作、修改特殊寄存器、底层各类驱动。在MINIX中将内存管理器（MM）和文件管理器（FS）作为一个服务也完全作为一个外部的用户进程来实现，然后通过消息通信机制来和内核共同完成操作，这样能达到高度模块化却完全符合微内核的本意，所以本质上MINIX使用到了三个特权级别（0,1,3）。

​	但是Flyanx我为了方便构造和优化性能，整体架构相同但区别于MINIX，我决定使用全部的四种特权级（0,1,2,3），并将服务器作为内核的一部分和内核链接在一起作为微内核的一部分，因为这些代码是由我编写的，它们完全可信任的，可以给予特权级2并将它们作为内核的一部分，这样处理的内核相比MINIX的内核性能相对较高且编译链接工程也相对简单，也适合用来做研究学习。

​	最后，根据整体功能划分，Flyanx的功能模块图如图所示。

![1581171260559](/tmp/1581171260559.png)

## 内核开发平台

​	在前面我们提过，我们需要开发的系统是i386体系下的，所以我们需要一个32位运行在i386下的操作系统，关于编译器方面，我决定使用开源的C语言编译器GCC（GUN C）。

​	既然是要编写操作系统，就有一个无法避免的问题：编写晦涩难懂的汇编代码。因为高级语言不能完成一些对硬件进行特殊的操作，所以汇编平台的选择也是一个问题，考虑到兼容性和可读性，我选择了开源的NASM汇编语言，它比较类似于Intel汇编，且兼容性特别好。

​	Flyanx内核的开发平台如下：

​	操作系统：Deepin Linux 64位（开发）、RedHat Linux 32位（编译链接）

​	C语言编译器：GCC 4.1.2 20070626

​	汇编语言编译器：NASM 0.98.39

​	开发集成IDE：Clion、Visual Studio Code

## 初始化工程结构

|- include 包含整个内核工程所需要的所有头文件

|- src 内核的所有源代码在该目录下

​	|- boot 包含电脑启动引导和安装Flyanx的代码

​	|- kernel 包含内核最基本的代码，即内核第1层（CPU权限0）和第2层（CPU权限1）的代码。

​	|- fly 包含飞彦拓展管理器(系统服务器)的代码，它以一个独立的进程运行，是内核的一部分。

​	|- fs 包含文件系统(系统服务器)的代码，它以一个独立的进程运行

​	|- mm 包含内存管理器(系统服务器)的代码，它以一个独立的进程运行

​	|- commands包含公用程序（如cat，cp，date，ls等等）的源代码，它们不属于内核，它们将会在系统第一次启动时会被安装到文件系统中以供用户使用。

​	|- lib 包含公共的库例程代码，它们会被许多地方调用，之下还分为系统调用库和系统库。

​	|- origin 包含起源程序源代码用于启动Flyanx，同时origin程序是整个系统进程的起源，所有新进程的祖先（fork链的最上层）。

|- target 内核代码编译的中间文件将全部放在这里面，便于最后完成链接。

​	



