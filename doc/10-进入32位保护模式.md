# 进入32位保护模式

​	为了加快内核编写的进程，我们之后有一些简单的函数编写将不在视频中一步步实现，将主要展示内核的主要流程。简单的函数将其会放在文档中，并做一些简单的介绍。

​	我们在进入保护模式前，最后完成一点小工作，加载内核文件前，先判断文件大小是否超过了我们预留给它的128KB，如果超过，打印提示并死循环。

​	之后我们在加载文件时，加一个地址进位判断，因为bx只能存放最大0xffff，也就是64KB，如果超出64KB将会产生进位，一旦进位，我们需要重新校准加载的es:bx，这样才能加载超过64KB的内核文件。

​	最后，我们将软盘驱动器的马达给关闭，因为在真机上，软驱不关闭可能会持续运行并发出声音，其实现例程如下。

```assembly
 ;============================================================================
 ;----------------------------------------------------------------------------
 ; 函数名: KillMotor
 ;----------------------------------------------------------------------------
 ; 作用:
 ;	关闭软驱马达，有时候软驱读取完如果不关闭马达，马达会持续运行且发出声音
 KillMotor:
 	push	dx
 	mov	dx, 03F2h
 	mov	al, 0
 	out	dx, al
 	pop	dx
 	ret
```

​	做完这些工作，我们马上开始编写进入保护模式的代码吧！





